<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Numbers KKH</title>
    <link rel="apple-touch-icon" href="https://i.imgur.com/gA32N36.png">

    <style>
        :root {
            --background-color: #F9F9F9;
            --card-background: #FFFFFF;
            --primary-color: #007AFF;
            --text-color: #111111;
            --subtle-text-color: #888888;
            --border-color: #EAEAEA;
            --error-color: #D9363E;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            background-color: var(--background-color);
        }

        #app-container {
            width: 100%;
            max-width: 480px;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: var(--card-background);
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .header-links {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .link-button {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-color);
            background-color: #F0F7FF;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s;
            -webkit-tap-highlight-color: transparent;
            white-space: nowrap;
        }
        
        .link-button:hover, .link-button:active {
            background-color: var(--primary-color);
            color: white;
        }

        .menu-container {
            position: relative;
        }

        .menu-button {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--subtle-text-color);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0 0.5rem;
            line-height: 1;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: calc(100% + 0.5rem);
            background-color: var(--card-background);
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
            border-radius: 8px;
            z-index: 10;
            border: 1px solid var(--border-color);
            padding: 0.5rem 0;
        }
        
        .menu-container:focus-within .dropdown-content {
            display: block;
        }

        .dropdown-content a {
            color: var(--text-color);
            padding: 0.75rem 1rem;
            text-decoration: none;
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        
        #clearDataBtn {
            color: var(--error-color);
            font-weight: 600;
        }

        main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            text-align: center;
        }
        
        main p {
            font-size: 1rem;
            color: var(--subtle-text-color);
            margin: 0 0 1rem 0;
        }

        .number-display-container {
            width: 100%;
            position: relative;
        }

        .number-display {
            font-family: "Courier New", Courier, monospace;
            font-size: clamp(1.8rem, 9vw, 2.5rem);
            font-weight: 600;
            padding: 1.5rem;
            border-radius: 12px;
            color: var(--primary-color);
            background-color: #F0F7FF;
            min-height: 70px;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-all;
        }

        /* --- NEW: Copy Button Styles --- */
        #copyBtn {
            display: none; /* Hidden by default */
            margin-top: 1rem;
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 0.6rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #copyBtn:hover {
            background-color: #F0F7FF;
        }
        
        #copyBtn.copied {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        footer {
            padding: 1rem 1.5rem;
            padding-bottom: calc(1rem + env(safe-area-inset-bottom));
            border-top: 1px solid var(--border-color);
        }
        
        #generateBtn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 100%;
            padding: 1.1rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        #generateBtn:active {
            transform: scale(0.98);
        }

        #generateBtn:disabled {
            background-color: #E5E5EA;
            color: var(--subtle-text-color);
            cursor: not-allowed;
            transform: none;
        }

        .stats {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--subtle-text-color);
            text-align: center;
        }

        .credits {
            margin-top: 1.5rem; 
            font-size: 0.8rem;
            color: var(--subtle-text-color);
            text-align: center;
        }

        .credits a {
            color: var(--primary-color); 
            font-weight: 500;
            text-decoration: none; 
            transition: text-decoration 0.2s;
        }

        .credits a:hover {
            text-decoration: underline; 
        }
    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <div class="header-content">
                <h1>Numbers KKH</h1>
                <div class="header-links">
                    <a href="https://t.me/+NaN5_AkWq0NlZmJl" target="_blank" rel="noopener noreferrer" class="link-button">OTP 1</a>
                    <a href="https://t.me/+ojDByxLadkIyNWNl" target="_blank" rel="noopener noreferrer" class="link-button">OTP 2</a>
                </div>
            </div>

            <div class="menu-container">
                <button class="menu-button" aria-label="Options menu">&#8942;</button>
                <div class="dropdown-content">
                    <a href="#" id="clearDataBtn">Clear Data</a>
                </div>
            </div>
        </header>
        
        <main>
            <p>Your unique number is:</p>
            <div class="number-display-container">
                <div class="number-display" id="numberDisplay">- - -</div>
            </div>
            <!-- === NEW: Copy Button Added Here === -->
            <button id="copyBtn">Copy</button>
        </main>
        
        <footer>
            <button id="generateBtn">Generate Number</button>
            <div class="stats">
                <span id="remainingCount">--</span> of <span id="totalCount">--</span> numbers available
            </div>
            <div class="credits">
                Owner: <a href="http://t.me/ComDotHimelOfficial" target="_blank" rel="noopener noreferrer">KKH Himel</a> | 
                Admin: <a href="http://t.me/RafiAhmedRifat" target="_blank" rel="noopener noreferrer">Rifat</a>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const numberDisplay = document.getElementById('numberDisplay');
            const generateBtn = document.getElementById('generateBtn');
            const clearDataBtn = document.getElementById('clearDataBtn'); 
            const copyBtn = document.getElementById('copyBtn'); // New button
            const totalCount = document.getElementById('totalCount');
            const remainingCount = document.getElementById('remainingCount');
            
            let allNumbers = [];
            let availableNumbers = [];
            let generatedNumbers = new Set();
            let copyTimeout;

            async function initializeApp() {
                try {
                    const response = await fetch(`numbers.txt?v=${new Date().getTime()}`);
                    if (!response.ok) { throw new Error(`HTTP error! Status: ${response.status}.`); }
                    
                    const text = await response.text();
                    allNumbers = text.trim().split(/\r?\n/).filter(line => line.trim() !== '');
                    
                    if (allNumbers.length === 0) { throw new Error("The numbers.txt file is empty or could not be read."); }

                    loadState(); 
                    updateUI();
                } catch (error) {
                    console.error('Initialization failed:', error);
                    numberDisplay.textContent = 'Load Error';
                    numberDisplay.style.color = 'var(--error-color)';
                    numberDisplay.style.backgroundColor = '#FFF0F0';
                    generateBtn.disabled = true;
                    generateBtn.textContent = 'Error';
                    remainingCount.textContent = '0';
                    totalCount.textContent = '0';
                }
            }
            
            const shuffleArray = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            };

            const loadState = () => {
                const stored = localStorage.getItem('appGeneratedNumbers');
                generatedNumbers = stored ? new Set(JSON.parse(stored)) : new Set();
                availableNumbers = allNumbers.filter(num => !generatedNumbers.has(num));
                shuffleArray(availableNumbers);
            };

            const saveState = () => {
                localStorage.setItem('appGeneratedNumbers', JSON.stringify(Array.from(generatedNumbers)));
            };

            const updateUI = () => {
                totalCount.textContent = allNumbers.length;
                remainingCount.textContent = availableNumbers.length;
                
                generateBtn.disabled = availableNumbers.length === 0;
                generateBtn.textContent = availableNumbers.length === 0 ? 'All Numbers Assigned' : 'Generate Number';
            };
            
            // --- UPDATED: Generate Button Logic ---
            generateBtn.addEventListener('click', () => {
                if (availableNumbers.length > 0) {
                    const newNumber = availableNumbers.pop();
                    generatedNumbers.add(newNumber);
                    numberDisplay.textContent = newNumber;

                    // Show the copy button
                    copyBtn.style.display = 'block';

                    if (navigator.vibrate) { navigator.vibrate(50); }
                    saveState();
                    updateUI();
                }
            });

            // --- NEW: Copy Button Logic ---
            copyBtn.addEventListener('click', () => {
                const numberToCopy = numberDisplay.textContent;
                if (numberToCopy && numberToCopy !== '- - -') {
                    navigator.clipboard.writeText(numberToCopy).then(() => {
                        // Success feedback
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');

                        // Clear previous timeout if it exists
                        clearTimeout(copyTimeout);

                        // Reset button after 2 seconds
                        copyTimeout = setTimeout(() => {
                            copyBtn.textContent = 'Copy';
                            copyBtn.classList.remove('copied');
                        }, 2000);

                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                        // Optionally, show an error to the user
                        copyBtn.textContent = 'Error';
                        setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
                    });
                }
            });
            
            clearDataBtn.addEventListener('click', (event) => {
                event.preventDefault(); 
                if (confirm('Are you sure you want to clear all data? This will reset the app and fetch the latest numbers.')) {
                    localStorage.removeItem('appGeneratedNumbers');
                    
                    numberDisplay.textContent = '- - -';
                    copyBtn.style.display = 'none'; // Hide copy button on clear
                    generatedNumbers = new Set();
                    availableNumbers = [];
                    document.activeElement.blur();
                    
                    initializeApp();
                }
            });

            initializeApp();
        });
    </script>
</body>
</html>